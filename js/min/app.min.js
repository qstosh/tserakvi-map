var App = angular.module('Map', ["ngAnimate", "cfp.hotkeys", "ngSanitize"])
  .directive('resizable', function($window) {
    return function($scope) {
      $scope.initializeWindowSize = function() {
        $scope.windowHeight = $window.innerHeight;
        $scope.windowWidth = $window.innerWidth;
      };
      angular.element($window).bind("resize", function() {
        $scope.initializeWindowSize();
        $scope.$apply();
      });
      $scope.initializeWindowSize();
    }
  })
  .controller('MapController', function($scope, hotkeys) {

    $scope.loaded = true;
    $scope.introActive = false;
    $scope.state = 0;
    $scope.definitionHidden = false;
    $scope.svg = "";

    $scope.mapWidth = 6415;
    $scope.mapHeight = 4000;

    $scope.workingAreaWidth = 4277 / 2;
    $scope.workingAreaHeight = 1500;

    $scope.mapOffsetTop = 0;
    $scope.mapOffsetLeft = 0;

    $scope.labelX = 0;
    $scope.labelY = 0;

    $scope.bgColor = '#fff';

    $scope.mapX = 0;
    $scope.mapXoffset = 0;
    $scope.mapY = 0;
    $scope.mapYoffset = 0;

    $scope.increase = function () {
      if($scope.state < 20) {

        $scope.state += 1;
      }
    };

    $scope.decrease = function () {
      if($scope.state >= 2) {

        $scope.state -= 1;
      }
    };

    // hotkeys.add({
    //   combo: 'right',
    //   callback: function() {
    //     $scope.increase();
    //   }
    // });
    //
    // hotkeys.add({
    //   combo: 'left',
    //   callback: function() {
    //     $scope.decrease();
    //   }
    // });
    //
    // hotkeys.add({
    //   combo: '1',
    //   callback: function() {
    //     $scope.state = 1;
    //   }
    // });
    //
    // hotkeys.add({
    //   combo: '2',
    //   callback: function() {
    //     $scope.state = 2;
    //   }
    // });
    //
    // hotkeys.add({
    //   combo: '3',
    //   callback: function() {
    //     $scope.state = 3;
    //   }
    // });
    //
    // hotkeys.add({
    //   combo: '4',
    //   callback: function() {
    //     $scope.state = 4;
    //   }
    // });
    //
    // hotkeys.add({
    //   combo: '5',
    //   callback: function() {
    //     $scope.state = 5;
    //   }
    // });
    //
    // hotkeys.add({
    //   combo: '6',
    //   callback: function() {
    //     $scope.state = 6;
    //   }
    // });
    //
    // hotkeys.add({
    //   combo: '7',
    //   callback: function() {
    //     $scope.state = 7;
    //   }
    // });
    //
    // hotkeys.add({
    //   combo: '8',
    //   callback: function() {
    //     $scope.state = 8;
    //   }
    // });
    //
    // hotkeys.add({
    //   combo: '9',
    //   callback: function() {
    //     $scope.state = 9;
    //   }
    // });
    //
    // hotkeys.add({
    //   combo: 'esc',
    //   callback: function() {
    //     $scope.state = 0;
    //   }
    // });

    // $scope.pageLoaded = function() {
    //   $scope.loaded = true;
    // }
    //
    // $scope.$watch('$viewContentLoaded', function(newVal, oldVal){
    //   $scope.loaded
    // });

    $scope.$watch('$viewContentLoaded', function(){
      $scope.loaded = true;
    });

    $scope.mapIsBiggerX = function() {

      if($scope.windowWidth < $scope.workingAreaWidth) {
        return true;
      } else {
        return false;
      }
    }

    $scope.mapIsBiggerY = function() {

      if($scope.windowHeight < $scope.workingAreaHeight) {
        return true;
      } else {
        return false;
      }
    }

    $scope.$watchGroup(['windowWidth', 'windowHeight', 'mapIsBiggerX', 'mapIsBiggerY'], function(newVal, oldVal) {

      // what's the viewport size
      $scope.watchWindowWidth = newVal[0];
      $scope.watchWindowHeight = newVal[1];

      // is map bigger
      $scope.watchMapIsBiggerX = newVal[2];
      $scope.watchMapIsBiggerY = newVal[3];

      // scale
      $scope.scaleWidth  = $scope.watchWindowWidth / $scope.workingAreaWidth;
      $scope.scaleHeight = $scope.watchWindowHeight / $scope.workingAreaHeight;

      // scaled sizes
      $scope.widthScalingX  = $scope.scaleWidth  * $scope.workingAreaWidth;
      $scope.widthScalingY  = $scope.scaleWidth  * $scope.workingAreaHeight;
      $scope.heightScalingX = $scope.scaleHeight * $scope.workingAreaWidth;
      $scope.heightScalingY = $scope.scaleHeight * $scope.workingAreaHeight;

      $scope.conditionOne   = false;
      $scope.conditionTwo   = false;
      $scope.conditionThree = false;
      $scope.conditionFour = false;

      $scope.mapScale = 1;

      if ($scope.state === 0) {

        $scope.test = 0;

        if ($scope.watchMapIsBiggerX() == true && $scope.widthScalingY <= $scope.watchWindowHeight) {

            $scope.mapScale = $scope.scaleWidth;
            $scope.mapScaleUpdated = $scope.scaleWidth;
            $scope.labelScale = ($scope.mapScale - 1) * -1 + 1;
            $scope.conditionOne = true;
            $scope.conditionTwo = false;
            $scope.conditionThree = false;
            $scope.conditionFour = false;
        }

        else if ($scope.watchMapIsBiggerX() == true && $scope.widthScalingY > $scope.watchWindowHeight) {

          $scope.mapScale = $scope.scaleHeight;
          $scope.mapScaleUpdated = $scope.scaleHeight;
          $scope.labelScale = ($scope.mapScale - 1) * -1 + 1;
          $scope.conditionTwo = true;
          $scope.conditionOne = false;
          $scope.conditionThree = false;
          $scope.conditionFour = false;
        }

        else if ($scope.watchMapIsBiggerY() == true && $scope.widthScalingX <= $scope.watchWindowWidth) {

            $scope.mapScale = $scope.scaleHeight;
            $scope.mapScaleUpdated = $scope.scaleHeight;
            $scope.labelScale = ($scope.mapScale - 1) * -1 + 1;
            $scope.conditionThree = true;
            $scope.conditionOne = false;
            $scope.conditionTwo = false;
            $scope.conditionFour = false;
        }

        // else {
        //
        //   $scope.mapScale = 1;
        //   $scope.mapScaleUpdated = 1;
        //   $scope.labelScale = ($scope.mapScale - 1) * -1 + 1;
        //   $scope.conditionOne = false;
        //   $scope.conditionTwo = false;
        //   $scope.conditionThree = false;
        // }
      }

      else if ($scope.state !== 0) {

        $scope.test = ($scope.watchWindowWidth * 35) / 100 / 2;

        $scope.mapScale = 1;
        $scope.conditionFour = true;

        if ($scope.watchMapIsBiggerX() == true && $scope.widthScalingY <= $scope.watchWindowHeight) {

            $scope.mapScaleUpdated = $scope.scaleWidth;
            $scope.labelScale = 1;
            $scope.conditionOne = true;
            $scope.conditionTwo = false;
            $scope.conditionThree = false;
            $scope.conditionFour = false;
        }

        else if ($scope.watchMapIsBiggerX() == true && $scope.widthScalingY > $scope.watchWindowHeight) {

          $scope.mapScaleUpdated = $scope.scaleHeight;
          $scope.labelScale = 1;
          $scope.conditionOne = false;
          $scope.conditionTwo = true;
          $scope.conditionThree = false;
          $scope.conditionFour = false;
        }

        else if ($scope.watchMapIsBiggerY() == true && $scope.widthScalingX <= $scope.watchWindowWidth) {

            $scope.mapScaleUpdated = $scope.scaleHeight;
            $scope.labelScale = 1;
            $scope.conditionOne = false;
            $scope.conditionTwo = false;
            $scope.conditionThree = true;
            $scope.conditionFour = false;
        }
      }
    });

    $scope.mapReset = function() {
      if ($scope.conditionOne === true) {
        $scope.mapScale = $scope.mapScaleUpdated;
        $scope.state = 0;
        $scope.mapX = 0;
        $scope.mapY = 0;
        $scope.mapXoffset = 0;
        $scope.mapYoffset = 0;
        $scope.labelScale = ($scope.mapScale - 1) * -1 + 1;
        $scope.test = 0;
      }

      else if ($scope.conditionTwo === true) {
        $scope.mapScale = $scope.mapScaleUpdated;
        $scope.state = 0;
        $scope.mapX = 0;
        $scope.mapY = 0;
        $scope.mapXoffset = 0;
        $scope.mapYoffset = 0;
        $scope.labelScale = ($scope.mapScale - 1) * -1 + 1;
        $scope.test = 0;
      }

      else if ($scope.conditionThree === true) {
        $scope.mapScale = $scope.mapScaleUpdated;
        $scope.state = 0;
        $scope.mapX = 0;
        $scope.mapY = 0;
        $scope.mapXoffset = 0;
        $scope.mapYoffset = 0;
        $scope.labelScale = ($scope.mapScale - 1) * -1 + 1;
        $scope.test = 0;
      }

      else if ($scope.conditionFour === true) {
        $scope.mapScale = $scope.mapScaleUpdated;
        $scope.state = 0;
        $scope.mapX = 0;
        $scope.mapY = 0;
        $scope.mapXoffset = 0;
        $scope.mapYoffset = 0;
        $scope.labelScale = ($scope.mapScale - 1) * -1 + 1;
        $scope.test = 0;
      }
    }

    $scope.items = [
      {
        title: "Wieża zamkowa",
        description: "<p>W wieży zamkowej, która górowała nad całym dziedzińcem, znajdowały się pomieszczenia mieszkalne i gospodarcze. W czasie oblężenia w niej chronili się mieszkańcy zamku. </p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: 30,
        y: -500,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "left-top"
      }

      ,{
        title: "Kuchnia",
        description: "<p>Tu kucharze przygotowywali posiłki dla pana zamku i jego rodziny.</p>",
        color: "#090909",
        hasImage: true,
        imageSrc: "http://unsplash.it/300/200",
        x: 70,
        y: -380,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "right-top"
      }

      ,{
        title: "Sypialnia",
        description: "<p>Komnaty sypialne pana zamku i jego rodziny.</p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: 50,
        y: -283,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "left-top"
      }

      ,{
        title: "Skarbiec",
        description: "<p>Przechowywano tu pod kluczem najcenniejsze rzeczy (na przykład złoto, srebro i klejnoty).</p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: 53,
        y: -203,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "left-bottom"
      }

      ,{
        title: "Jadalnia",
        description: "<p>Tutaj na co dzień jadał pan zamku i jego rodzina.</p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: 141,
        y: -274,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "right-top"
      }

      ,{
        title: "Zbrojownia",
        description: "<p>Przechowywano tu broń i zbroje.</p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: 284,
        y: -207,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "right-bottom"
      }

      ,{
        title: "Latryna",
        description: "<p>Prymitywna toaleta, z której mogło na raz korzystać kilku mieszkańców zamku.</p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: 669,
        y: -254,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "left-top"
      }

      ,{
        title: "Kaplica",
        description: "<p>W kaplicy można było się pomodlić. Tu odbywały się też uroczystości religijne.</p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: 309,
        y: -98,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "right-bottom"
      }

      ,{
        title: "Sala rycerska",
        description: "<p>Przyjmowano tu gości i organizowano uroczyste uczty.</p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: 210,
        y: -74,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "left-bottom"
      }

      ,{
        title: "Lochy",
        description: "<p>Przetrzymywano tu więźniów.</p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: 342,
        y: 136,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "right-bottom"
      }

      ,{
        title: "Dziedziniec zamkowy",
        description: "<p>Na zamkowym dziedzińcu toczyło się życie codzienne. Tutaj też odbywały się turnieje rycerskie.</p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: -183,
        y: 0,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "left-top"
      }

      ,{
        title: "Baszty",
        description: "<p>Mury obronne były wzmocnione basztami, czyli wieżami strażniczymi, na których pełnili swoją wartę strażnicy. Ich obowiązkiem było obserwowanie okolicy i jak najszybsze powiadomienie mieszkańców zamku o zbliżającym się niebezpieczeństwie. Wieże były lokowane w strategicznych częściach murów. Znajdowały się w nich kwatery mieszkalne dla załogi zamku lub magazyny.</p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: -170,
        y: 198 ,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "right-bottom"
      }

      ,{
        title: "Most zwodzony",
        description: "<p>Do zamku można było wjechać po moście zwodzonym. Za pomocą specjalnych urządzeń most podnoszono wieczorami i w razie zagrożenia. W ten sposób uniemożliwiano wrogom przedostanie się do zamku.</p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: 206,
        y: 442,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "right-bottom"
      }

      ,{
        title: "Brama wjazdowa",
        description: "<p>Brama była często zabezpieczona żelazną lub drewnianą kratą, którą w razie potrzeby opuszczano do samej ziemi. W ten sposób można było szybko zablokować wjazd lub wyjazd z zamku, odcinając drogę ucieczki.</p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: -575,
        y: 263,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "right-bottom"
      }

      ,{
        title: "Mury obronne",
        description: "<p>Zamek otaczały wysokie mury obronne, u szczytu zakończone blankami (tak zwanymi zębami).</p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: -745,
        y: 180,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "left-top"
      }

      ,{
        title: "Kuźnia",
        description: "<p>W kuźni można było podkuć konia. Kowale robili też narzędzia z żelaza i je naprawiali.</p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: -213,
        y: -150,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "left-top"
      }

      ,{
        title: "Zbiornik na deszczówkę",
        description: "<p>Woda deszczowa nadawała się do picia, co było ważne w czasie oblężenia.</p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: -587,
        y: -209,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "left-top"
      }

      ,{
        title: "Piekarnia",
        description: "<p>W obrębie murów zamkowych znajdowały się warsztaty rzemieślników. Na przykład piekarnia, która zaopatrywała mieszkańców zamku w chleb.</p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: -210,
        y: -305,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "left-top"
      }

      ,{
        title: "Fosa",
        description: "<p>Zamek często otaczała fosa, czyli rów wypełniony wodą.</p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: -160,
        y: 511,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "left-bottom"
      }

      ,{
        title: "Stajnia",
        description: "<p>Z dala od pomieszczeń mieszkalnych znajdowały się stajnie dla koni.</p>",
        color: "#090909",
        hasImage: false,
        imageSrc: "",
        x: -718,
        y: -125,
        xOffset: 0,
        yOffset: 0,
        pointer: true,
        position: "left-top"
      }
    ];
})
